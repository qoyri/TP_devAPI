{
	admin off
}

:8443 {
	tls /etc/caddy/certs/cert.pem /etc/caddy/certs/key.pem

	log {
		output stdout
		format console
	}

	# Swagger MySQL (FastAPI)
	@docs_mysql path /docs/mysql
	handle @docs_mysql {
		rewrite * /api-docs
		reverse_proxy mysql-api:3001
	}

	# Swagger Spark (Express)
	@docs_spark path /docs/spark
	handle @docs_spark {
		rewrite * /api-docs
		reverse_proxy spark-api:3002
	}

	# Swagger OAuth2 (Elixir/Phoenix)
	@docs_oauth path /docs/oauth
	handle @docs_oauth {
		rewrite * /api-docs
		reverse_proxy oauth2-server:4000
	}

	# OAuth2
	handle /oauth/* {
		reverse_proxy oauth2-server:4000
	}

	# API Entreprises
	handle /api/entreprises/* {
		uri strip_prefix /api
		reverse_proxy mysql-api:3001
	}

	# API Stats
	handle /api/stats/* {
		uri strip_prefix /api
		reverse_proxy spark-api:3002
	}

	handle /health {
		respond "OK" 200
	}

	handle {
		respond "API SIREN - /docs/oauth, /docs/mysql, /docs/spark" 200
	}
}
